@import "ui-variables";
@import "syntax-variables";

/*
* Your Stylesheet
*
* This stylesheet is loaded when Atom starts up and is reloaded automatically
* when it is changed.
*
* If you are unfamiliar with LESS, you can read more about it here:
* http://www.lesscss.org
*/

// @editor-font: 'Operator Mono SSm';
// @editor-font: 'Consolamono';
// @editor-font: 'Input';
// @editor-font: 'Monoid';
// @editor-font: 'Space Mono';
// @editor-font: 'Fira Code';

// @use-italic: italic;
@use-italic: normal;


/* Font settings - Editor and UI */
html, body, atom-workspace,
atom-text-editor {
  // font-family: 'Operator Mono SSM', 'Source Code Pro';
  // font-family: 'Courier Prime Code';
  // font-family: 'Monoid'
  // font-family: @editor-font;
  font-weight: 200;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

// Customize tab colors for atom dark
.theme-atom-dark-ui .tab-bar {
  padding-top: 5px;
  height: auto;
  &:after {
    background: @syntax-background-color;
    border: none;
    // display: none;
    height: 0 !important;
  }
  .tab { top: 0; }
  .tab.active[data-type="TextEditor"] {
    &,
    &:after,
    &:before {
      background: @syntax-background-color;
      color: @syntax-text-color;
      box-shadow: none;
    }
  }
}

.tree-view {
  // Make directories bold in tree view
  li.list-nested-item.directory > .list-item > .name {
    font-weight: 600;
  }

  // Don't color icons in the tree view (but do color them elsewhere)
  .icon:before {
    color: inherit !important;
  }
}

// Monoid Mess
* {
  // text-rendering: optimizeLegibility;
  // -webkit-font-smoothing: antialiased;
  // -webkit-font-feature-settings: "liga" on, "calt" on;
}

// General editor settings and syntax tweaks
atom-text-editor {

  .syntax--source.syntax--gfm,  .syntax--text.syntax--md {
    .syntax--markup {
      -webkit-font-smoothing: antialiased;

      &.syntax--quote {
        font-style: @use-italic;
        // font-style: normal;
      }

      &.syntax--heading {
        font-style: @use-italic;
        font-weight: bold;
        // font-style: normal;
      }
    }

    // There's no such thing in a bad ampersand
    .syntax--invalid.syntax--bad-ampersand {
      color: inherit;
      background: inherit;
      font-weight: inherit;
    }
  }

  // I like my comments italic, and some syntax themes don't agree
  .syntax--comment,
  .syntax--punctuation.syntax--definition.syntax--comment
   {
    font-style: @use-italic;
    // font-style: normal;
  }

  // Italic strings too!!!
  .syntax--string {
    font-style: @use-italic;
    // font-style: normal;
    &.syntax--punctuation, .syntax--source, &.syntax--unquoted { font-style: normal; }
    .syntax--unquoted.syntax--yaml { font-style: @use-italic; }
  }


  // Tweak colors for indent-guide-improved
  .indent-guide-improved {
    background-color: mix(@syntax-indent-guide-color, @syntax-background-color);
    &.indent-guide-stack {
      background-color: mix(@syntax-indent-guide-color, @syntax-background-color);
      &.indent-guide-active {
        background-color: @syntax-indent-guide-color;
      }
    }
  }

  // Tweak indent guide positioning (for built-in guides)
  @indent-offset: 5px; // This might need tweaking depending on font and size
  @guide-width: 1px;

  // Shift indent guides to align vertically with center of column
  .indent-guide {
    // box-shadow: none;
  //   background: linear-gradient(90deg, // replace box-shadow with gradient
  //     transparent,
  //     transparent @indent-offset,
  //     @syntax-indent-guide-color @indent-offset,
  //     @syntax-indent-guide-color @indent-offset + @guide-width,
  //     transparent @indent-offset + @guide-width)
  }
  //
  // .indent-guide-improved {
  //   // width: @indent-offset + @guide-width;
  //   &, &.indent-guide-stack, &.indent-guide-stack.indent-guide-active {
  //     background: linear-gradient(90deg, // replace box-shadow with gradient
  //       transparent,
  //       transparent @indent-offset,
  //       @syntax-indent-guide-color @indent-offset,
  //       @syntax-indent-guide-color @indent-offset + @guide-width,
  //       transparent @indent-offset + @guide-width)
  //   }
  // }

  // Tweak pigments display
  pigment-markers::shadow pigment-color-marker .region.background {
    border-radius: 3px;
  }

  // Try to make invisible characters generally less visually obtrusive
  .invisible-character {
    color: mix(@syntax-text-color, @syntax-background-color, 7%);
  }
  .trailing-whitespace { // Just show trailing whitespace
    // Use `syntax-color-removed` since it's usually red
    // Unfortunately, the invisible characters are behind the indent guide, so
    // we have to use background rather than foreground (since I have moved the
    // indent guides over to be centered in the character column)
    color: @syntax-color-removed;   
  }

  // Tweaks to line numbers in the gutter
  .gutter .line-number {
    &.cursor-line {
      font-weight: bold;
    }
    &.git-line-added {
      color: mix(@syntax-color-added, @syntax-gutter-text-color); }
    &.git-line-modified {
      color: mix(@syntax-color-modified, @syntax-gutter-text-color);
    }
  }
}

// THEME-SPECIFIC SETTINGS

atom-text-editor {
  .theme-atom-dark-fusion-syntax & {
    .variable.other.less::first-letter {
      // color: fade(#4dbac7, 5%);
      color: red;
    }
  }

  .theme-gruvbox-plus-syntax & {

    @bg1: #ebdbb2;
    @bg2: #d5c4a1;
    @bg3: #bdae93;
    @bg4: #a89984;
    @gray: #928374;
    @fg1: #3c3836;
    @fg2: #504945;
    @fg3: #665c54;
    @fg4: #7c6f64;
    @red: #9d0006;
    @green: #79740e;
    @yellow: #b57614;
    @blue: #076678;
    @purple: #8f3f71;
    @aqua: #427b58;
    @orange: #af3a03;
    @neutral-red: #cc241d;
    @neutral-green: #98971a;
    @neutral-yellow: #d79921;
    @neutral-blue: #458588;
    @neutral-purple: #b16286;
    @neutral-aqua: #689d6a;
    @neutral-orange: #d65d0e;

    .syntax--punctuation.syntax--definition.syntax--string {
      color: @neutral-green;
    }
    .syntax--regexp {
      color: @aqua;
      &.syntax--punctuation {
        color: @neutral-aqua;
      }
    }

    // attempt to hack in `.markup` and `.language-md` support
    .syntax--markup, .syntax--md {
      .syntax--punctuation { color: @bg3; }

      .syntax--code { color: @orange; }
      .syntax--code > .syntax--punctuation { color: @neutral-orange; }
      .syntax--fenced > .syntax--language { color: @orange; }

      &.syntax--list { color: @syntax-text-color; }

      .syntax--link {
        .syntax--string > .syntax--punctuation { color: @neutral-green; }
        > .syntax--punctuation { color: @neutral-blue; }
        &.syntax--destination, &.syntax--hyperlink { color: @blue; }
      }
    }
    
    .syntax--symbol > .syntax--punctuation.syntax--definition {
      color: @neutral-purple;
    }
  }

  .theme-eclectic-syntax & {
    // @invisible-color: darken(@syntax-background-color, 3%);
    @subtle-guide-color: mix(@syntax-background-color, @syntax-gutter-text-color, 75%);
    @invisible-color: @subtle-guide-color;

    .gutter { border: none; }
    .wrap-guide { background-color: @invisible-color; }
    .invisible-character:not(.trailing-whitespace) { color: @invisible-color; }

    .indent-guide-improved {
      background-color: @subtle-guide-color;
      &.indent-guide-stack {
        background-color: @subtle-guide-color;
        &.indent-guide-active {
          background-color: @syntax-gutter-text-color;
        }
      }
    }

    .constant {
      // &.symbol { color: #469c91; }
      &.numeric { font-weight: 600; }
    }
  }

  .theme-brilliant-syntax {
    .minimap .cursor-line {
      background: @syntax-selection-color;
    }
  }
  
  .theme-dark-side-of-the-moon-syntax & {
    .syntax--source .syntax--comment {
      .syntax--storage.syntax--type {
        margin-left: -0.4em;
        margin-right: -0.4em;
      }
    }
  }
}

// XXX This still doesn't make it match, but it makes it closer
.theme-dark-side-of-the-moon-syntax {
  .gutter .line-number{
    background-color: @syntax-background-color;
  }
}

.theme-atom-material-ui {
  atom-panel.modal.overlay.from-top {
    top: 25%;
    border-radius: 0.125rem;
    border: 2px solid #E040FB; // use accent color for tab panel border
  }

  .scroll-view {
    padding-left: 0;
  }
  .tab-bar .tab.active {
    background-color: #673AB7;
  }
}

// IDEA Add a panel to the bottom of the tree view showing git status
// You could color the whole background based on status and show the branch and
// change counts as text. It would line up with the editor status-bar and seems
// like a more logical place than the bottom of the editor.
// What do you do when the sidebar is collapsed?
