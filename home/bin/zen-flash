#!/bin/sh

set -e

# allow setting directory for firmware files
if [ $1 ]
then
   cd $1
fi

# gh run download -n firmware
if [ ! -f corneish_zen_v2_right-zmk.uf2 ] || [ ! -f corneish_zen_v2_left-zmk.uf2 ]
then
    echo "Can't find firmware files!"
    exit 1
fi

trap 'exit 1' 2

echo "Please connect the $(tput bold)left$(tput sgr0) half.\nWaiting for Zen to connect\c"
while [ ! -d /Volumes/CORNEISHZEN ]
do
    echo '.\c'
    sleep 1
done
sleep 1
cp corneish_zen_v2_left-zmk.uf2 /Volumes/CORNEISHZEN/
echo "\n"


while [ -d /Volumes/CORNEISHZEN ]
do
    sleep 1
done

echo "Please connect the $(tput bold)right$(tput sgr0) half.\nWaiting for Zen to connect\c"
while [ ! -d /Volumes/CORNEISHZEN ]
do
    echo '.\c'
    sleep 1
done
sleep 1
cp corneish_zen_v2_right-zmk.uf2 /Volumes/CORNEISHZEN/

echo "\nDone!"
